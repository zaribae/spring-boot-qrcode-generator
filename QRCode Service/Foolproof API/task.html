<div class="step-text">
<p></p><h5 id="description">Description</h5><p>QR codes have four error correction levels, determining how much code can be damaged or obscured while still readable. These levels are:</p><ol><li><p><strong>Level L (Low)</strong>: The QR code can withstand up to approximately 7% damage.</p></li><li><p><strong>Level M (Medium)</strong>: The QR code can withstand up to approximately 15% damage.</p></li><li><p><strong>Level Q (Quartile)</strong>: The QR code can withstand up to approximately 25% damage.</p></li><li><p><strong>Level H (High)</strong>: The QR code can withstand up to approximately 30% damage.</p></li></ol><p>These levels provide a trade-off between data capacity and resilience. Higher error correction levels require more space, reducing the amount of data that can be stored in the QR code. In this stage, the service should be able to handle a new request parameter, <code class="language-java">correction</code> that defines the error correction level desired by the client. The accepted <code class="language-java">correction</code> values should be <code class="language-java">L</code>, <code class="language-java">M</code>, <code class="language-java">Q</code> and <code class="language-java">H</code>. If a client specifies an incorrect correction level, the service should respond with the status code <code class="language-java">400 BAD REQUEST</code> and a JSON with the <code class="language-java">error</code> field and an appropriate error message. </p><p>If a request contains multiple invalid parameters, the error messages should have the following priority:</p><p>invalid contents &gt; invalid size &gt; invalid correction &gt; invalid type</p><p>To implement different error correction levels, use the overloaded version of the <code class="language-java">encode</code> method of the <code class="language-java">QRCodeWriter</code> class. Besides the contents, barcode format, width, and height, it accepts encoder hints represented by a <code class="language-java">Map</code> where keys are constants of the <code class="language-java">EncodeHintType</code> and values are appropriate objects. It may sound confusing, but don't worry, we will explore a practical example. In our case, we need the specific <code class="language-java">EncodeHintType</code> as key, which is the <code class="language-java">EncodeHintType.ERROR_CORRECTION</code>. As a value, we will have to use the constants of the <code class="language-java">ErrorCorrectionLevel</code> enum, namely <code class="language-java">ErrorCorrectionLevel.L</code>, <code class="language-java">ErrorCorrectionLevel.M</code>, <code class="language-java">ErrorCorrectionLevel.Q</code> or <code class="language-java">ErrorCorrectionLevel.H</code>. Here is the updated version of the QR code generation:</p><pre><code class="language-java">import com.google.zxing.BarcodeFormat;
import com.google.zxing.EncodeHintType;
import com.google.zxing.WriterException;
import com.google.zxing.client.j2se.MatrixToImageWriter;
import com.google.zxing.common.BitMatrix;
import com.google.zxing.qrcode.QRCodeWriter;
import com.google.zxing.qrcode.decoder.ErrorCorrectionLevel;

QRCodeWriter writer = new QRCodeWriter();
Map&lt;EncodeHintType, ?&gt; hints = Map.of(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.H);
try {
    BitMatrix bitMatrix = writer.encode(contents, BarcodeFormat.QR_CODE, width, height, hints);
    BufferedImage bufferedImage = MatrixToImageWriter.toBufferedImage(bitMatrix);
} catch (WriterException e) {
    // handle the WriterException
}</code></pre><p>In addition to the parameters, we have created the <code class="language-java">Map</code> of encode hints and set the error correction level to <code class="language-java">H</code> (high). To set the medium error correction level, you will need to replace <code class="language-java">ErrorCorrectionLevel.H</code> with the relevant value. That's it!</p><p>In addition, let's make the QR code API more user-friendly. Now, all parameters except for <code class="language-java">contents</code> should be optional and should have default values. If a client does not specify a particular request parameter, apply the corresponding default value:</p><ul><li><p>default <code class="language-java">size</code> is <code class="language-java">250</code></p></li><li><p>default <code class="language-java">correction</code> is <code class="language-java">L</code></p></li><li><p>default <code class="language-java">type</code> is <code class="language-java">png</code></p></li></ul><p>If a client specifies an invalid value for an optional parameter, the service should respond with the status code <code class="language-java">400 BAD REQUEST</code>, a JSON with the <code class="language-java">error</code> field, and an appropriate error message. The exact requirements as in the previous stage apply.</p><h5 id="objectives">Objectives</h5><ul><li><p>Modify the <code class="language-java">GET /api/qrcode</code> endpoint to accept a new parameter, <code class="language-java">correction</code>, which represents the desired QR code error correction level and can only have values <code class="language-java">L</code>, <code class="language-java">M</code>, <code class="language-java">Q</code> or <code class="language-java">H</code>.</p></li><li><p>Generate a QR code from the provided content, applying parameters from the request, including the error correction level.</p></li><li><p>If the provided <code class="language-java">correction</code> is not valid, the endpoint should return the status code <code class="language-java">400 BAD REQUEST</code> and a request body in the JSON format with the following contents:</p><pre><code class="language-json">{
    "error": "Permitted error correction levels are L, M, Q, H"
}</code></pre></li><li><p>The requirements for handling the other request parameters remain unchanged. If a request contains multiple invalid parameters, the error messages should have the following priority: invalid contents =&gt; invalid size =&gt; invalid correction =&gt; invalid type.</p></li><li><p>All request parameters except for the contents should be optional and have the following default values: default <code class="language-java">size</code> is <code class="language-java">250</code>, default <code class="language-java">correction</code> is <code class="language-java">L</code> , and default <code class="language-java">type</code> is <code class="language-java">png</code>.</p></li></ul><h5 id="examples">Examples</h5><p><strong>Example 1</strong>. <em>a GET request to /api/qrcode with a correct contents and default other parameters</em>:</p><p><em>Request</em>: <code class="language-java">GET /api/qrcode?contents=abcdef</code></p><p><em>Response code</em>: <code class="language-java">200 OK</code></p><p><em>Response header</em>: <code class="language-java">Content-Type: image/png</code></p><p><em>Response body:</em> byte array</p><p><strong>Example 2</strong>. <em>a GET request to /api/qrcode with an incorrect correction parameter</em>:</p><p><em>Request</em>: <code class="language-java">GET /api/qrcode?contents=abcde&amp;correction=S</code></p><p><em>Response code</em>: <code class="language-java">400 BAD REQUEST</code></p><p><em>Response body</em>:</p><pre><code class="language-json">{
    "error": "Permitted error correction levels are L, M, Q, H"
}</code></pre><p><strong>Example 3</strong>. <em>a GET request to /api/qrcode with incorrect contents and correction parameters</em>:</p><p><em>Request</em>: <code class="language-java">GET /api/qrcode?contents=&amp;correction=S</code></p><p><em>Response code</em>: <code class="language-java">400 BAD REQUEST</code></p><p><em>Response body</em>:</p><pre><code class="language-json">{
    "error": "Contents cannot be null or blank"
}</code></pre><p><strong>Example 4</strong>. <em>a GET request to /api/qrcode with an incorrect correction and type parameters</em>:</p><p><em>Request</em>: <code class="language-java">GET /api/qrcode?contents=abcde&amp;correction=S&amp;type=tiff</code></p><p><em>Response code</em>: <code class="language-java">400 BAD REQUEST</code></p><p><em>Response body</em>:</p><pre><code class="language-json">{
    "error": "Permitted error correction levels are L, M, Q, H"
}</code></pre>
</div>